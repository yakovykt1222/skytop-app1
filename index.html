<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f4f4f7; color: #000; display: flex; flex-direction: column; align-items: center; padding: 20px 0; margin: 0; }
        .card { background: white; border-radius: 20px; width: 90%; max-width: 380px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; text-align: center; }
        .title { font-size: 14px; color: #8e8e93; font-weight: 600; text-transform: uppercase; margin-bottom: 10px; }
        .timer { font-size: 32px; font-weight: 800; color: #007aff; margin-bottom: 20px; }
        
        .btn-main { background: #007aff; color: white; border: none; border-radius: 14px; padding: 16px; width: 100%; font-size: 16px; font-weight: 600; cursor: pointer; }
        
        /* –í—ã–±–æ—Ä —Å—É–º–º—ã */
        #payment-options { display: none; margin-top: 15px; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .opt-btn { background: #f2f2f7; border: 1px solid #e5e5ea; border-radius: 10px; padding: 10px 5px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .opt-btn:active { background: #007aff; color: white; }

        /* –†–µ—Ñ–µ—Ä–∞–ª–∫–∞ */
        .ref-box { display: flex; gap: 10px; margin-top: 15px; }
        .btn-ref { flex: 1; background: #f2f2f7; color: #007aff; border: none; border-radius: 10px; padding: 12px; font-size: 13px; font-weight: 600; cursor: pointer; }

        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .instr-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
        .instr-link { background: #fff; border: 1px solid #e5e5ea; border-radius: 12px; padding: 10px; text-decoration: none; color: #000; font-size: 12px; font-weight: 600; }
    </style>
</head>
<body>

    <div class="card">
        <div class="title">–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:</div>
        <div class="timer" id="expire-timer">00–¥ 00—á 00–º</div>
        <button class="btn-main" id="topup-btn" onclick="toggleOptions()">üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        
        <div id="payment-options">
            <button class="opt-btn" onclick="pay(80)">80 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(160)">160 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(240)">240 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(320)">320 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(400)">400 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(480)">480 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(560)">560 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(640)">640 ‚ÇΩ</button>
            <button class="opt-btn" onclick="pay(720)">720 ‚ÇΩ</button>
        </div>
    </div>

    <div class="card">
        <div class="title">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ ‚Äî –ø–æ–ª—É—á–∏ +7 –¥–Ω–µ–π</div>
        <div style="font-size: 13px; color: #8e8e93;">–î—Ä—É–≥ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø, –∞ –≤—ã ‚Äî –Ω–µ–¥–µ–ª—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ!</div>
        <div class="ref-box">
            <button class="btn-ref" onclick="copyRef()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn-ref" onclick="shareRef()">üîó –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div class="card">
        <div class="title">–í–∏–¥–µ–æ–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</div>
        <div class="instr-grid">
            <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">üçè iOS</a>
            <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">ü§ñ Android</a>
            <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">üíª PC</a>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const userId = tg.initDataUnsafe.user.id;
        const NGROK_URL = 'https://undepressible-candie-infinitival.ngrok-free.dev'; // –û–ë–ù–û–í–ò –≠–¢–û

        function toggleOptions() {
            const div = document.getElementById('payment-options');
            div.style.display = div.style.display === 'grid' ? 'none' : 'grid';
        }

        async function pay(amount) {
            const res = await fetch(`${NGROK_URL}/create-payment`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ amount, user_id: userId })
            });
            const data = await res.json();
            if (data.link) tg.openLink(data.link);
        }

        function copyRef() {
            const link = `https://t.me/skytopvpnbot?start=${userId}`;
            navigator.clipboard.writeText(link);
            tg.showScanQrPopup({text: "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!"}); // –ú–∏–Ω–∏-—Ö–∞–∫ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            setTimeout(() => tg.closeScanQrPopup(), 1000);
        }

        function shareRef() {
            const link = `https://t.me/skytopvpnbot?start=${userId}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=–ü–æ–ª—å–∑—É–π—Å—è –∫—Ä—É—Ç—ã–º VPN!`);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ (–∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É)
        async function updateTimer() {
            try {
                const res = await fetch(`${NGROK_URL}/get-status?user_id=${userId}`);
                const data = await res.json();
                document.getElementById('expire-timer').innerText = data.time_left;
            } catch (e) { console.error("–û—à–∏–±–∫–∞ —Ç–∞–π–º–µ—Ä–∞"); }
        }
        setInterval(updateTimer, 5000);
        updateTimer();
    </script>
</body>
</html>
