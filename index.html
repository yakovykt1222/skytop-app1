<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script> 
    <style>
        :root {
            --main-blue: #007aff;
            --bg-color: #f4f4f7;
            --card-bg: #ffffff;
            --text-gray: #8e8e93;
            --success-green: #34c759;
            --error-red: #ff3b30;
        }

        body { 
            font-family: -apple-system, sans-serif; 
            background-color: var(--bg-color); 
            color: #000; 
            margin: 0; 
            padding-bottom: 30px; 
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--card-bg);
            border-bottom: 1px solid #e5e5ea;
        }

        .logo { font-weight: 800; font-size: 18px; color: var(--main-blue); }

        .container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-top: 15px; 
        }

        .card { 
            background: var(--card-bg); 
            border-radius: 20px; 
            width: 92%; 
            max-width: 400px; 
            padding: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            margin-bottom: 15px; 
            text-align: center; 
        }

        .title { 
            font-size: 11px; 
            color: var(--text-gray); 
            font-weight: 600; 
            text-transform: uppercase; 
            margin-bottom: 10px; 
        }

        .status-text { 
            font-size: 22px; 
            font-weight: 800; 
            margin-bottom: 5px; 
        }

        .expire-date { 
            font-size: 14px; 
            color: var(--text-gray); 
            margin-bottom: 20px; 
        }

        .key-box {
            display:none;
            background:#f2f2f7;
            padding:12px;
            border-radius:12px;
            font-size:12px;
            word-break:break-all;
            margin-bottom:10px;
        }

        .btn-ref { 
            flex: 1; 
            background: #f2f2f7; 
            color: var(--main-blue); 
            border: none; 
            border-radius: 10px; 
            padding: 12px; 
            font-size: 13px; 
            font-weight: 600; 
            cursor: pointer; 
        }

        .btn-primary {
            width:100%;
            background: var(--main-blue);
            color:#fff;
            border:none;
            border-radius:14px;
            padding:14px;
            font-size:15px;
            font-weight:700;
            cursor:pointer;
            margin-top:10px;
        }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">SkyTop VPN</div>
</div>

<div class="container">

    <!-- –°–¢–ê–¢–£–° -->
    <div class="card">
        <div class="title">–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞</div>
        <div id="sub-status" class="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="sub-date" class="expire-date">–ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ...</div>
        <button id="pay-btn" class="btn-primary" style="display:none;">
            üí≥ –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
        </button>
    </div>

    <!-- –ö–õ–Æ–ß -->
    <div class="card">
        <div class="title">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</div>
        <div class="amounts-grid">
        ...
        </div>
        <button class="btn-confirm" id="confirm-pay-btn" onclick="processPayment()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å</button>
    </div>
        
        <div class="title">–í–∞—à VPN –∫–ª—é—á</div>

        <div id="key-status" style="font-size:13px;color:#8e8e93;margin-bottom:10px;">
            –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É...
        </div>

        <div id="key-box" class="key-box">
            ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢
        </div>

        <div style="display:flex;gap:8px;">
            <button class="btn-ref" onclick="toggleKey()" id="toggle-key-btn" style="display:none;">
                üëÅ –ü–æ–∫–∞–∑–∞—Ç—å
            </button>

            <button class="btn-ref" onclick="openInApp()" id="open-app-btn" style="display:none;">
                üöÄ –û—Ç–∫—Ä—ã—Ç—å
            </button>
        </div>

        <button class="btn-primary" onclick="rotateKey()" id="rotate-btn" style="display:none;">
            üîÑ –°–º–µ–Ω–∏—Ç—å –∫–ª—é—á
        </button>
    </div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 0;
const BASE_URL = "https://api.skytop.space";

let vpnKey = "";
let keyVisible = false;

// ====== –°–¢–ê–¢–£–° ======

async function updateStatus() {
    try {
        const res = await fetch(`${BASE_URL}/get-status?user_id=${userId}`);
        const data = await res.json();

        const statusEl = document.getElementById("sub-status");
        const dateEl = document.getElementById("sub-date");

        if (!statusEl || !dateEl) return;

        if (data.time_left && data.time_left !== "–ò—Å—Ç–µ–∫–ª–∞") {
            statusEl.innerText = "–ê–∫—Ç–∏–≤–Ω–∞";
            statusEl.style.color = "#34c759";
            dateEl.innerText = "–û—Å—Ç–∞–ª–æ—Å—å: " + data.time_left;
        } else {
            statusEl.innerText = "–ù–µ –∞–∫—Ç–∏–≤–Ω–∞";
            statusEl.style.color = "#ff3b30";
            dateEl.innerText = "–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å";
        }

    } catch (e) {
        console.log(e);
    }
}
// ====== –ö–õ–Æ–ß ======

async function loadKey() {
    const res = await fetch(`${BASE_URL}/get-key?user_id=${userId}`);
    const data = await res.json();

    const statusEl = document.getElementById("key-status");
    const toggleBtn = document.getElementById("toggle-key-btn");
    const openBtn = document.getElementById("open-app-btn");
    const rotateBtn = document.getElementById("rotate-btn");

    if (data.active) {
        vpnKey = data.key;
        statusEl.innerText = "–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞";
        statusEl.style.color = "#34c759";
        toggleBtn.style.display = "block";
        openBtn.style.display = "block";
        rotateBtn.style.display = "block";
    } else {
        statusEl.innerText = "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞";
        statusEl.style.color = "#ff3b30";
    }
}

function toggleKey() {
    const box = document.getElementById("key-box");
    const btn = document.getElementById("toggle-key-btn");

    if (!vpnKey) return;

    keyVisible = !keyVisible;

    if (keyVisible) {
        box.innerText = vpnKey;
        box.style.display = "block";
        btn.innerText = "üôà –°–∫—Ä—ã—Ç—å";
    } else {
        box.innerText = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
        btn.innerText = "üëÅ –ü–æ–∫–∞–∑–∞—Ç—å";
    }
}

function openInApp() {
    if (!vpnKey) return;
    tg.openLink(vpnKey);
}

// ====== –°–ú–ï–ù–ê –ö–õ–Æ–ß–ê ======

async function rotateKey() {
    if (!userId) return;

    const btn = document.getElementById("rotate-key-btn");
    btn.innerText = "‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...";
    btn.disabled = true;

    try {
        const res = await fetch(`${BASE_URL}/rotate-key`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ user_id: userId })
        });

        const data = await res.json();

        if (data.status === "success") {
            vpnKey = data.link;
            keyVisible = true;

            document.getElementById("key-box").innerText = vpnKey;
            document.getElementById("key-box").style.display = "block";

            tg.showAlert("–ö–ª—é—á —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω ‚úÖ");
        } else {
            tg.showAlert(data.message || "–û—à–∏–±–∫–∞");
        }

    } catch (e) {
        tg.showAlert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è");
    }

    btn.innerText = "üîÑ –°–º–µ–Ω–∏—Ç—å –∫–ª—é—á";
    btn.disabled = false;
}
        <script>
        <script>
const tg = window.Telegram.WebApp;
tg.expand();

const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 0;
const BASE_URL = "https://api.skytop.space";

let vpnKey = "";
let keyVisible = false;

// ================= –û–ü–õ–ê–¢–ê =================

let selectedPrice = 0;

function selectPrice(price, btn) {
    selectedPrice = price;

    document.querySelectorAll(".opt-btn").forEach(b => {
        b.classList.remove("active");
    });

    btn.classList.add("active");

    document.getElementById("confirm-pay-btn").style.display = "block";
}

function processPayment() {
    if (!selectedPrice) {
        tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É");
        return;
    }

    tg.sendData(JSON.stringify({
        action: "pay",
        amount: selectedPrice
    }));
}

// ================= –°–ú–ï–ù–ê –ö–õ–Æ–ß–ê =================

async function rotateKey() {
    if (!userId) return;

    const btn = document.getElementById("rotate-key-btn");
    btn.innerText = "‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...";
    btn.disabled = true;

    try {
        const res = await fetch(`${BASE_URL}/rotate-key`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user_id: userId })
        });

        const data = await res.json();

        if (data.status === "success") {
            vpnKey = data.link;
            keyVisible = true;

            document.getElementById("key-box").innerText = vpnKey;
            document.getElementById("key-box").style.display = "block";

            tg.showAlert("–ö–ª—é—á —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω ‚úÖ");
        } else {
            tg.showAlert(data.message || "–û—à–∏–±–∫–∞");
        }

    } catch (e) {
        tg.showAlert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è");
    }

    btn.innerText = "üîÑ –°–º–µ–Ω–∏—Ç—å –∫–ª—é—á";
    btn.disabled = false;
}

        // ===== –¢–£–¢ –£–ñ–ï –ë–´–õ–û =====
             

// –∑–∞–ø—É—Å–∫
updateStatus();
loadKey();
    
</script>
</body>
</html>




