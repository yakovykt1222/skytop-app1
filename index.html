<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f4f4f7; color: #000; display: flex; flex-direction: column; align-items: center; padding: 20px 0; margin: 0; }
        .card { background: white; border-radius: 20px; width: 90%; max-width: 380px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; text-align: center; }
        .title { font-size: 13px; color: #8e8e93; font-weight: 600; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.5px; }
        .timer { font-size: 32px; font-weight: 800; color: #007aff; margin-bottom: 20px; }
        
        /* –°–µ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—É–º–º—ã */
        .amounts-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .opt-btn { 
            background: #f2f2f7; 
            border: 2px solid transparent; 
            border-radius: 12px; 
            padding: 12px 5px; 
            font-size: 15px; 
            font-weight: 700; 
            cursor: pointer; 
            transition: all 0.2s ease;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
        .opt-btn.active { 
            border-color: #007aff; 
            background: #fff; 
            color: #007aff; 
            box-shadow: 0 4px 10px rgba(0,122,255,0.1);
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (—Å–∫—Ä—ã—Ç–∞ –¥–æ –≤—ã–±–æ—Ä–∞) */
        .btn-confirm { 
            background: #007aff; 
            color: white; 
            border: none; 
            border-radius: 14px; 
            padding: 18px; 
            width: 100%; 
            font-size: 16px; 
            font-weight: 700; 
            cursor: pointer; 
            display: none; /* –°–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .ref-box { display: flex; gap: 10px; margin-top: 15px; }
        .btn-ref { flex: 1; background: #f2f2f7; color: #007aff; border: none; border-radius: 10px; padding: 12px; font-size: 13px; font-weight: 600; cursor: pointer; }
        .instr-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
        .instr-link { background: #fff; border: 1px solid #e5e5ea; border-radius: 12px; padding: 10px; text-decoration: none; color: #000; font-size: 12px; font-weight: 600; }
    </style>
</head>
<body>

    <div class="card">
        <div class="title">–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –µ—â–µ:</div>
        <div class="timer" id="expire-timer">...</div>
        
        <div class="title">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</div>
        <div class="amounts-grid">
            <button class="opt-btn" onclick="selectPrice(80, this)">80 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(160, this)">160 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(240, this)">240 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(320, this)">320 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(400, this)">400 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(480, this)">480 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(560, this)">560 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(640, this)">640 ‚ÇΩ</button>
            <button class="opt-btn" onclick="selectPrice(720, this)">720 ‚ÇΩ</button>
        </div>

        <button class="btn-confirm" id="confirm-pay-btn" onclick="processPayment()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å</button>
    </div>

    <div class="card">
        <div class="title">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ (+7 –¥–Ω–µ–π)</div>
        <div class="ref-box">
            <button class="btn-ref" onclick="copyReferralLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <button class="btn-ref" onclick="shareReferralLink()">üîó –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥—Ä—É–≥—É</button>
        </div>
    </div>

    <div class="card">
        <div class="title">–í–∏–¥–µ–æ–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</div>
        <div class="instr-grid">
            <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">iOS</a>
            <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">Android</a>
            <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">Windows</a>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const userId = tg.initDataUnsafe.user.id;
        
        // –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò –≠–¢–û –ü–†–ò –ü–ï–†–ï–ó–ê–ü–£–°–ö–ï NGROK
        const NGROK_URL = ' https://undepressible-candie-infinitival.ngrok-free.dev'; 
// --- –§—É–Ω–∫—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞ ---
        async function updateStatus() {
            const timerEl = document.getElementById('expire-timer');
            try {
                const res = await fetch(`${NGROK_URL}/get-status?user_id=${userId}`);
                if (!res.ok) throw new Error();
                const data = await res.json();
                timerEl.innerText = data.time_left;
                timerEl.style.color = "#007aff";
            } catch (e) {
                timerEl.innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏";
                timerEl.style.color = "red";
            }
        }
        let chosenAmount = 0;

        // 1. –§—É–Ω–∫—Ü–∏—è —Ç–æ–ª—å–∫–æ –í–´–ë–û–†–ê —Å—É–º–º—ã
        function selectPrice(amount, element) {
            chosenAmount = amount;
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.opt-btn').forEach(btn => btn.classList.remove('active'));
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–∞–∂–∞—Ç—É—é
            element.classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const payBtn = document.getElementById('confirm-pay-btn');
            payBtn.style.display = 'block';
            payBtn.innerText = `–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É ${amount} ‚ÇΩ`;
        }

        // 2. –§—É–Ω–∫—Ü–∏—è —Å–∞–º–æ–π –û–ü–õ–ê–¢–´ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–æ–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
        async function processPayment() {
            const btn = document.getElementById('confirm-pay-btn');
            btn.disabled = true;
            btn.innerText = "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–Ω–∫—É...";

            try {
                const response = await fetch(`${NGROK_URL}/create-payment`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ amount: chosenAmount, user_id: userId })
                });
                const result = await response.json();
                if (result.link) {
                    tg.openLink(result.link);
                } else {
                    alert("–û—à–∏–±–∫–∞: " + result.error);
                }
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.");
            } finally {
                btn.disabled = false;
                btn.innerText = `–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É ${chosenAmount} ‚ÇΩ`;
            }
        }

        // 3. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ (–ë–ï–ó QR-–∫–æ–¥–∞)
        function copyReferralLink() {
            const link = `https://t.me/skytopvpnbot?start=${userId}`;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(link).then(() => {
                    tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
                });
            } else {
                // –ó–∞–ø–∞—Å–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö WebView
                const textArea = document.createElement("textarea");
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
                } catch (err) {
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å");
                }
                document.body.removeChild(textArea);
            }
        }

        function shareReferralLink() {
            const link = `https://t.me/skytopvpnbot?start=${userId}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=–õ–æ–≤–∏ –∫—Ä—É—Ç–æ–π VPN! –ü–æ–¥–ø–∏—Å–∫–∞ –≤—Å–µ–≥–æ 80—Ä.`);
        }

        async function updateStatus() {
            const timerEl = document.getElementById('expire-timer');
            try {
        // –û–®–ò–ë–ö–ê –ë–´–õ–ê –¢–£–¢: –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–æ—Å–ª–µ NGROK_URL —Å—Ç–æ–∏—Ç /get-status
                const res = await fetch(`${NGROK_URL}/get-status?user_id=${userId}`);
        
                if (!res.ok) {
                    console.error("–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª —Å –æ—à–∏–±–∫–æ–π:", res.status);
                    throw new Error();
        }
        
                const data = await res.json();
                timerEl.innerText = data.time_left; // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å "00–¥ 00—á" –∏–ª–∏ –≤—Ä–µ–º—è
                timerEl.style.color = "#007aff";
    }         catch (e) {
                timerEl.innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏";
                timerEl.style.color = "red";
    }
}

// –ò –ù–ï –ó–ê–ë–£–î–¨ –í–´–ó–í–ê–¢–¨ –§–£–ù–ö–¶–ò–Æ:
updateStatus();
        setInterval(updateStatus, 10000);
    </script>
</body>
</html>






