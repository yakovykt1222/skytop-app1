<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script> 
    <style>
        :root {
            --main-blue: #007aff;
            --bg-color: #f4f4f7;
            --card-bg: #ffffff;
            --text-gray: #8e8e93;
            --success-green: #34c759;
            --error-red: #ff3b30;
        }

        body { 
            font-family: -apple-system, sans-serif; 
            background-color: var(--bg-color); 
            color: #000; 
            margin: 0; 
            padding-bottom: 30px; 
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--card-bg);
            border-bottom: 1px solid #e5e5ea;
        }

        .logo { font-weight: 800; font-size: 18px; color: var(--main-blue); }

        .container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-top: 15px; 
        }

        .card { 
            background: var(--card-bg); 
            border-radius: 20px; 
            width: 75%; 
            max-width: 400px; 
            padding: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            margin-bottom: 15px; 
            text-align: center; 
        }
        .ref-title {
            font-size: 12px;
            color: #8e8e93;
            text-transform: uppercase;
            text-align: center;    /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç */
            margin-bottom: 15px;   /* –û—Ç—Å—Ç—É–ø –¥–æ –∫–Ω–æ–ø–æ–∫ */
            font-weight: 600;
        }


        .status-text { 
            font-size: 22px; 
            font-weight: 800; 
            margin-bottom: 5px; 
        }

        .expire-date { 
            font-size: 14px; 
            color: var(--text-gray); 
            margin-bottom: 20px; 
        }

        .key-box {
            display:none;
            background:#f2f2f7;
            padding:12px;
            border-radius:12px;
            font-size:12px;
            word-break:break-all;
            margin-bottom:10px;
        }
        .ref-box {
            display: flex;
            gap: 12px;
            justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ */
            padding-bottom: 5px;     /* –ù–µ–±–æ–ª—å—à–æ–π –∑–∞–∑–æ—Ä —Å–Ω–∏–∑—É */
        }

        .btn-ref {
            flex: 1;
            display: flex;
            align-items: center;    /* –¶–µ–Ω—Ç—Ä –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            justify-content: center; /* –¶–µ–Ω—Ç—Ä –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            gap: 8px;               /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º */
            background: #f2f2f7;
            color: #007aff;
            border: none;
            border-radius: 12px;
            padding: 14px;          /* –ß—É—Ç—å —É–≤–µ–ª–∏—á–∏–º –≤—ã—Å–æ—Ç—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –Ω–∞–∂–∞—Ç–∏—è */
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary {
            width:auto%;
            background: var(--main-blue);
            color:#fff;
            border:none;
            border-radius:14px;
            padding:14px;
            font-size:15px;
            font-weight:700;
            cursor:pointer;
            margin-top:10px;
        }
       /* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ */
        .btn-ref:active {
            background-color: #e5e5ea;
        }
        .doc-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: #34c759; /* –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ */
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
        }

        .back-btn {
            background: #007aff; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ */
            margin-top: 10px;
        }
        
        .doc-btn:active {
            opacity: 0.8;
        }

        
 /* –°–µ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—É–º–º—ã */
        .amounts-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .opt-btn { background: #f2f2f7; border: 2px solid transparent; border-radius: 12px; padding: 12px 5px; font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.2s ease; }
        .opt-btn.active { border-color: var(--main-blue); background: #fff; color: var(--main-blue); box-shadow: 0 4px 10px rgba(0,122,255,0.1); }

        .btn-confirm { background: var(--main-blue); color: white; border: none; border-radius: 14px; padding: 18px; width: 100%; font-size: 16px; font-weight: 700; cursor: pointer; display: none; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .ref-box { display: flex; gap: 10px; margin-top: 15px; }
        .btn-ref { flex: 1; background: #f2f2f7; color: var(--main-blue); border: none; border-radius: 10px; padding: 12px; font-size: 13px; font-weight: 600; cursor: pointer; }
        .instr-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
        .instr-link { background: #fff; border: 1px solid #e5e5ea; border-radius: 12px; padding: 10px; text-decoration: none; color: #000; font-size: 12px; font-weight: 600; }

   
    </style>
</head>
<body>

<div class="container">
    <!-- –°–¢–ê–¢–£–° -->
    <div class="card">
        <div class="title">–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞</div>
        <div id="sub-status" class="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="sub-date" class="expire-date">–ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ...</div>
        <button id="pay-btn" class="btn-primary" style="display:none;">
            üí≥ –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
        </button>
    </div>

    <!-- –ö–õ–Æ–ß -->
<div class="card">
    <div class="title">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</div>
    <div class="amounts-grid">
        <button class="opt-btn" onclick="selectPrice(80, this)">80 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(160, this)">160 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(240, this)">240 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(320, this)">320 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(400, this)">400 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(480, this)">480 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(560, this)">560 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(640, this)">640 ‚ÇΩ</button>
        <button class="opt-btn" onclick="selectPrice(720, this)">720 ‚ÇΩ</button>
    </div>
    <button class="btn-confirm" id="confirm-pay-btn" onclick="processPayment()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å</button>
</div> <div class="card">
    <div class="title">–í–∞—à VPN –∫–ª—é—á</div>
    <div id="key-status" style="font-size:13px;color:#8e8e93;margin-bottom:10px; text-align: center;">
        –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É...
    </div>
    <div id="key-box" class="key-box">
        ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢
    </div>
    <div style="display:flex; gap:8px; margin-top: 10px;">
        <button class="btn-ref" onclick="toggleKey()" id="toggle-key-btn" style="display:none;">üëÅ –ü–æ–∫–∞–∑–∞—Ç—å</button>
        <button class="btn-ref" onclick="copyKey()" id="copy-btn" style="display:none;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn-ref" onclick="openInApp()" id="open-app-btn" style="display:none;">üöÄ –û—Ç–∫—Ä—ã—Ç—å</button>
    </div>
    <button class="btn-primary" onclick="rotateKey()" id="rotate-btn" style="display:none; margin-top: 10px; width: 100%;">
        üîÑ –°–º–µ–Ω–∏—Ç—å –∫–ª—é—á
    </button>
</div> <div class="card">
    <div class="title" style="text-align: center;">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ (+7 –¥–Ω–µ–π)</div>
    <div class="ref-box" style="display: flex; gap: 10px; margin-top: 15px;">
        <button class="btn-ref" onclick="copyReferralLink()" style="flex: 1;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn-ref" onclick="shareReferralLink()" style="flex: 1;">üîó –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    <button class="btn-ref" onclick="showDocsMenu()" style="width: 100%; margin-top: 15px; background: none; color: #8e8e93; font-size: 12px;">
        üìú –ü—Ä–∞–≤–∏–ª–∞ –∏ –û—Ñ–µ—Ä—Ç–∞
    </button>
</div>
       
<div id="rules-screen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f2f2f7; z-index: 1000; overflow-y: auto; padding: 20px; box-sizing: border-box;">
    <button onclick="hideRules()" style="background: none; border: none; color: #007aff; font-size: 17px; font-weight: 600; cursor: pointer; margin-bottom: 20px; display: flex; align-items: center;">
        ‚Äπ –ù–∞–∑–∞–¥
    </button>
    
<div id="docs-menu" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f2f2f7; z-index: 1000; padding: 20px; box-sizing: border-box;">
    <div style="max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; gap: 10px; margin-top: 50px;">
        
        <button class="doc-btn" onclick="showFullText('agreement')">üìÑ –°–æ–≥–ª–∞—Å–∏–µ</button>
        <button class="doc-btn" onclick="showFullText('offer')">üì© –û—Ñ–µ—Ä—Ç–∞</button>
        <button class="doc-btn" onclick="showFullText('privacy')">üìÉ –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</button>
        
        <button class="doc-btn back-btn" onclick="hideDocsMenu()">üë§ –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞–±–∏–Ω–µ—Ç</button>
    </div>
</div>

<div id="text-screen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 1100; overflow-y: auto; padding: 20px; box-sizing: border-box;">
    <button onclick="hideFullText()" style="background: none; border: none; color: #007aff; font-size: 17px; font-weight: 600; margin-bottom: 20px;">‚Äπ –ù–∞–∑–∞–¥</button>
    <div id="content-area" style="font-size: 14px; line-height: 1.5; color: #333;"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();
let currentVpnKey = ""; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–∞
const userId = tg.initDataUnsafe?.user?.id; // –ë–µ—Ä–µ–º ID –ø—Ä—è–º–æ –∏–∑ –¥–∞–Ω–Ω—ã—Ö Telegram
console.log("USER ID:", userId);

const BASE_URL = "https://api.skytop.space";

let vpnKey = "";
let keyVisible = false;
let selectedPrice = 0;

// ===== –°–¢–ê–¢–£–° =====
async function updateStatus() {
    try {
        const res = await fetch(`${BASE_URL}/get-status?user_id=${userId}`);
        const data = await res.json();

        const statusEl = document.getElementById("sub-status");
        const dateEl = document.getElementById("sub-date");

        if (!statusEl || !dateEl) return;

        if (data.time_left && data.time_left !== "–ò—Å—Ç–µ–∫–ª–∞") {
            statusEl.innerText = "–ê–∫—Ç–∏–≤–Ω–∞";
            statusEl.style.color = "#34c759";
            dateEl.innerText = "–û—Å—Ç–∞–ª–æ—Å—å: " + data.time_left;
        } else {
            statusEl.innerText = "–ù–µ –∞–∫—Ç–∏–≤–Ω–∞";
            statusEl.style.color = "#ff3b30";
            dateEl.innerText = "–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å";
        }

    } catch (e) {
        console.log(e);
    }
}

// ===== –ö–õ–Æ–ß =====
async function loadKey() {
    try {
        const res = await fetch(`${BASE_URL}/get-status?user_id=${userId}`);
        const data = await res.json();

        const statusEl = document.getElementById("key-status");
        const toggleBtn = document.getElementById("toggle-key-btn");
        const openBtn = document.getElementById("open-app-btn");
        const rotateBtn = document.getElementById("rotate-btn");
        const copyBtn = document.getElementById("copy-btn"); // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        if (data.vpn_key_status === "–ê–∫—Ç–∏–≤–µ–Ω") {
            vpnKey = data.vpn_key; // —É–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ Python —ç—Ç–æ –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫
            statusEl.innerText = "–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞";
            statusEl.style.color = "#34c759";
            toggleBtn.style.display = "block";
            openBtn.style.display = "block";
            rotateBtn.style.display = "block";
            if (copyBtn) copyBtn.style.display = "block"; // –ü–û–ö–ê–ó–´–í–ê–ï–ú –ö–ù–û–ü–ö–£ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø
        } else {
            statusEl.innerText = "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞";
            statusEl.style.color = "#ff3b30";
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ—Ç
            if (copyBtn) copyBtn.style.display = "none";
        }

    } catch (e) {
        console.log(e);
    }
}

function toggleKey() {
    const box = document.getElementById("key-box");
    const btn = document.getElementById("toggle-key-btn");

    if (!vpnKey) return;

    keyVisible = !keyVisible;

    if (keyVisible) {
        box.innerText = vpnKey;
        box.style.display = "block";
        btn.innerText = "üôà –°–∫—Ä—ã—Ç—å";
    } else {
        box.innerText = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
        btn.innerText = "üëÅ –ü–æ–∫–∞–∑–∞—Ç—å";
    }
}

function openInApp() {
    if (!vpnKey || vpnKey === "" || vpnKey.includes('‚Ä¢')) {
        alert("–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");
        return;
    }

    // –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º tg.openLink, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –≤—ã–¥–∞–µ—Ç WebAppTgUrlInvalid
    // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º "—Ç—Ä—é–∫" —Å –Ω–µ–≤–∏–¥–∏–º–æ–π —Å—Å—ã–ª–∫–æ–π
    try {
        const link = document.createElement('a');
        link.href = vpnKey;
        // –í–∞–∂–Ω–æ: –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º target="_blank", —á—Ç–æ–±—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ª–∏—à–Ω–∏—Ö –≤–∫–ª–∞–¥–æ–∫
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (e) {
        // –ï—Å–ª–∏ –¥–∞–∂–µ —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –ø—Ä–æ–±—É–µ–º –∂–µ—Å—Ç–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
        window.location.assign(vpnKey);
    }
}

// ===== –û–ü–õ–ê–¢–ê =====
function selectPrice(price, btn) {
    selectedPrice = price;

    document.querySelectorAll(".opt-btn").forEach(b => {
        b.classList.remove("active");
    });

    btn.classList.add("active");
    document.getElementById("confirm-pay-btn").style.display = "block";
}

function processPayment() {
    if (!selectedPrice) {
        tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É");
        return;
    }

    tg.sendData(JSON.stringify({
        action: "pay",
        amount: selectedPrice
    }));
}


 // –í—ã–±–æ—Ä —Ü–µ–Ω—ã
        let chosenAmount = 0;
        function selectPrice(amount, element) {
            chosenAmount = amount;
            document.querySelectorAll('.opt-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            const payBtn = document.getElementById('confirm-pay-btn');
            payBtn.style.display = 'block';
            payBtn.innerText = `–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å ${amount} ‚ÇΩ`;
        }

        // –û–ø–ª–∞—Ç–∞
        async function processPayment() {
            const btn = document.getElementById('confirm-pay-btn');
            btn.disabled = true;
            btn.innerText = "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–Ω–∫—É...";
            try {
                const response = await fetch(`${BASE_URL}/create-payment`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ amount: chosenAmount, user_id: userId })
                });
                const result = await response.json();
                if (result.link) {
                    tg.openLink(result.link);
                } else {
                    tg.showAlert("–û—à–∏–±–∫–∞: " + result.error);
                }
            } catch (err) {
                tg.showAlert("–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç.");
            } finally {
                btn.disabled = false;
                btn.innerText = `–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å ${chosenAmount} ‚ÇΩ`;
            }
        }

    

    
// ===== –°–ú–ï–ù–ê –ö–õ–Æ–ß–ê =====
async function rotateKey() {
    if (!userId) return;

    const btn = document.getElementById("rotate-btn");
    btn.innerText = "‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...";
    btn.disabled = true;

    try {
        const res = await fetch(`${BASE_URL}/rotate-key?user_id=${userId}`, {
            method: "POST"
        });

        if (res.ok) {
            const data = await res.json(); // –°—Ä–∞–∑—É –ø–∞—Ä—Å–∏–º JSON
            
            if (data.success || data.new_key) {
                vpnKey = data.new_key; // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                
                // –ï—Å–ª–∏ –ø–ª–∞—à–∫–∞ —Å –∫–ª—é—á–æ–º –æ—Ç–∫—Ä—ã—Ç–∞ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º –≤ –Ω–µ–π —Ç–µ–∫—Å—Ç
                const box = document.getElementById("key-box");
                if (keyVisible) {
                    box.innerText = vpnKey;
                }

                tg.showAlert("‚úÖ –ö–ª—é—á —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!");
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å (–¥–∞—Ç—É), —á—Ç–æ–±—ã –≤—Å—ë –±—ã–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
                await updateStatus(); 
            }
        } else {
            tg.showAlert("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏");
        }

    } catch (e) {
        console.error("FETCH ERROR:", e);
        tg.showAlert("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
    } finally {
        btn.innerText = "üîÑ –°–º–µ–Ω–∏—Ç—å –∫–ª—é—á";
        btn.disabled = false;
    }
}



  // –†–µ—Ñ–µ—Ä–∞–ª–∫–∞
function copyReferralLink() {
    if (!userId) {
        tg.showAlert("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à ID");
        return;
    }
    const link = `https://t.me/skytopvpnbot?start=${userId}`;
    
    // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ)
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(link).then(() => {
            tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        });
    } else {
        // –¢–≤–æ–π —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π
        const el = document.createElement('textarea');
        el.value = link;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
    }
}

function shareReferralLink() {
    if (!userId) {
        tg.showAlert("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à ID");
        return;
    }
    const link = `https://t.me/skytopvpnbot?start=${userId}`;
    const text = "–õ–æ–≤–∏ –∫—Ä—É—Ç–æ–π VPN! –ü–æ–¥–ø–∏—Å–∫–∞ –≤—Å–µ–≥–æ 80—Ä.";
    tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`);
}
// –í–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –≥–¥–µ —Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, updateUserData)
function updateUI(data) {
    if (data.vpn_key) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
        document.getElementById('toggle-key-btn').style.display = 'block';
        document.getElementById('open-app-btn').style.display = 'block';
        document.getElementById('copy-btn').style.display = 'block'; // –≠–¢–ê –°–¢–†–û–ö–ê –í–ö–õ–Æ–ß–ò–¢ –ö–ù–û–ü–ö–£

        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–ª—é—á –≤ –±–ª–æ–∫ (id –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–º, —á—Ç–æ –≤ HTML)
        const keyBox = document.getElementById('vpn-key-box'); 
        if(keyBox) keyBox.innerText = data.vpn_key;
    }
}
// –°–∞–º–∞ —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
function copyKey() {
    if (!vpnKey) {
        alert("–ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω");
        return;
    }

    navigator.clipboard.writeText(vpnKey).then(() => {
        const btn = document.getElementById('copy-btn');
        const originalText = btn.innerText;
        btn.innerText = "‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ";
        
        // –í–∏–±—Ä–∞—Ü–∏—è –≤ Telegram
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        }

        setTimeout(() => {
            btn.innerText = originalText;
        }, 2000);
    }).catch(err => {
        alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–ª—é—á");
    });
}

// –ü—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç–≤–æ–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
function onDataLoaded(data) {
    if (data.vpn_key) {
        currentVpnKey = data.vpn_key; // –í–æ—Ç —ç—Ç–æ –í–ê–ñ–ù–û
        document.getElementById('vpn-key').innerText = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
    }
}    
function copyKeyForce() {
    // 1. –ë–µ—Ä–µ–º –∫–ª—é—á –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –ø—É—Ç—å)
    let keyToCopy = currentVpnKey;
    
    // 2. –ï—Å–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –ø—É—Å—Ç–æ, –ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å —Å —ç–∫—Ä–∞–Ω–∞ (–µ—Å–ª–∏ —Ç–∞–º –Ω–µ —Ç–æ—á–∫–∏)
    if (!keyToCopy || keyToCopy === "") {
        const keyEl = document.getElementById('vpn-key');
        if (keyEl && !keyEl.innerText.includes('‚Ä¢')) {
            keyToCopy = keyEl.innerText;
        }
    }

    // 3. –ï—Å–ª–∏ –≤—Å—ë –µ—â–µ –ø—É—Å—Ç–æ ‚Äî –∑–Ω–∞—á–∏—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤–æ–æ–±—â–µ
    if (!keyToCopy || keyToCopy === "" || keyToCopy.includes('‚Ä¢')) {
        alert("–ö–ª—é—á –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.");
        return;
    }

    // 4. –ö–æ–ø–∏—Ä—É–µ–º
    copyTextToClipboard(keyToCopy);
}

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è –≤—Å–µ—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤)
function copyTextToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
            handleSuccessCopy();
        });
    } else {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed"; // –ò–∑–±–µ–≥–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
            document.execCommand('copy');
            handleSuccessCopy();
        } catch (err) {
            alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
        }
        document.body.removeChild(textArea);
    }
}

const texts = {
    agreement: "<h1>–°–æ–≥–ª–∞—Å–∏–µ</h1><p>–¢—É—Ç —Ç–µ–∫—Å—Ç –≤–∞—à–µ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è...</p>",
    offer: "<h1>–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</h1><p>1. –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É... <br>2. –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –≤–æ–∑–º–æ–∂–µ–Ω –ø—Ä–∏ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏...</p>",
    privacy: "<h1>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</h1><p>–ú—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –ª–æ–≥–∏ –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π...</p>"
};

function showDocsMenu() {
    document.getElementById('docs-menu').style.display = 'block';
}

function hideDocsMenu() {
    document.getElementById('docs-menu').style.display = 'none';
}

function showFullText(type) {
    document.getElementById('content-area').innerHTML = texts[type];
    document.getElementById('text-screen').style.display = 'block';
}

function hideFullText() {
    document.getElementById('text-screen').style.display = 'none';
}
    
function handleSuccessCopy() {
    const btn = document.getElementById('copy-btn');
    const originalText = btn.innerText;
    btn.innerText = "‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
    
    if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
    }
    
    setTimeout(() => {
        btn.innerText = originalText;
    }, 2000);
}    
// ===== –ó–ê–ü–£–°–ö =====
updateStatus();
loadKey();
</script>













































