<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script> 
    <style>
        :root {
            --main-blue: #007aff;
            --bg-color: #f4f4f7;
            --card-bg: #ffffff;
            --text-gray: #8e8e93;
            --success-green: #34c759;
            --error-red: #ff3b30;
        }

        body { 
            font-family: -apple-system, sans-serif; 
            background-color: var(--bg-color); 
            color: #000; 
            margin: 0; 
            padding-bottom: 30px; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--card-bg);
            border-bottom: 1px solid #e5e5ea;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo { font-weight: 800; font-size: 18px; color: var(--main-blue); }
        
        /* –ú–µ–Ω—é */
        .menu-container { position: relative; }
        .menu-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--main-blue); padding: 0 5px; }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 35px;
            background-color: white;
            min-width: 200px;
            box-shadow: 0px 8px 24px rgba(0,0,0,0.15);
            z-index: 1000;
            border-radius: 12px;
            overflow: hidden;
        }
        .dropdown-content a {
            color: black;
            padding: 14px 16px;
            text-decoration: none;
            display: block;
            font-size: 15px;
            border-bottom: 1px solid #f2f2f7;
        }
        .dropdown-content a:active { background-color: #f2f2f7; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .container { display: flex; flex-direction: column; align-items: center; padding-top: 15px; }
        .card { 
            background: var(--card-bg); 
            border-radius: 20px; 
            width: 92%; 
            max-width: 400px; 
            padding: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            margin-bottom: 15px; 
            text-align: center; 
            box-sizing: border-box; 
        }
        .title { font-size: 11px; color: var(--text-gray); font-weight: 600; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.5px; }
        
        /* –°—Ç–∞—Ç—É—Å */
        .status-text { font-size: 22px; font-weight: 800; color: var(--main-blue); margin-bottom: 5px; }
        .expire-date { font-size: 14px; color: var(--text-gray); margin-bottom: 20px; }

        /* –°–µ—Ç–∫–∞ —Ü–µ–Ω */
        .amounts-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .opt-btn { 
            background: #f2f2f7; 
            border: 2px solid transparent; 
            border-radius: 12px; 
            padding: 12px 5px; 
            font-size: 15px; 
            font-weight: 700; 
            cursor: pointer; 
            transition: all 0.2s; 
        }
        .opt-btn.active { border-color: var(--main-blue); background: #fff; color: var(--main-blue); }

        .btn-confirm { 
            background: var(--main-blue); 
            color: white; 
            border: none; 
            border-radius: 14px; 
            padding: 18px; 
            width: 100%; 
            font-size: 16px; 
            font-weight: 700; 
            cursor: pointer; 
            display: none; 
        }
        
        .ref-box { display: flex; gap: 10px; margin-top: 10px; }
        .btn-ref { flex: 1; background: #f2f2f7; color: var(--main-blue); border: none; border-radius: 10px; padding: 12px; font-size: 13px; font-weight: 600; cursor: pointer; }
        
        .instr-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
        .instr-link { 
            background: #fff; 
            border: 1px solid #e5e5ea; 
            border-radius: 12px; 
            padding: 10px; 
            text-decoration: none; 
            color: #000; 
            font-size: 12px; 
            font-weight: 600; 
        }

        /* –ú–æ–¥–∞–ª–∫–∞ */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .modal-content { 
            background-color: white; 
            margin: 10% auto; 
            padding: 20px; 
            width: 85%; 
            max-width: 400px; 
            max-height: 75vh;
            border-radius: 24px; 
            display: flex;
            flex-direction: column;
        }
        .modal-scroll { overflow-y: auto; padding-right: 8px; text-align: left; }
        .close-modal { background: var(--main-blue); color: white; border: none; border-radius: 12px; padding: 15px; width: 100%; font-weight: 700; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">SkyTop VPN</div>
        <div class="menu-container">
            <button class="menu-btn" onclick="toggleMenu()">‚ãÆ</button>
            <div id="dropdown-menu" class="dropdown-content">
                <a href="#" onclick="openSupport()">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                <a href="#" onclick="showRules()">üìú –ü—Ä–∞–≤–∏–ª–∞ –∏ –û—Ñ–µ—Ä—Ç–∞</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="title">–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞:</div>
            <div id="sub-status" class="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="sub-date" class="expire-date">–ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ...</div>
            
            <div class="title" style="margin-top: 10px;">–ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É:</div>
            <div class="amounts-grid">
                <button class="opt-btn" onclick="selectPrice(80, this)">80 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(160, this)">160 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(240, this)">240 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(320, this)">320 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(400, this)">400 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(480, this)">480 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(560, this)">560 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(640, this)">640 ‚ÇΩ</button>
                <button class="opt-btn" onclick="selectPrice(720, this)">720 ‚ÇΩ</button>
            </div>
            <button class="btn-confirm" id="confirm-pay-btn" onclick="processPayment()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        </div>

        <div class="card">
            <div class="title">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</div>
            <p style="font-size: 12px; color: var(--text-gray);">+7 –¥–Ω–µ–π –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞</p>
            <div class="ref-box">
                <button class="btn-ref" onclick="copyReferralLink()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn-ref" onclick="shareReferralLink()">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            </div>
        </div>

        <div class="card">
            <div class="title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</div>
            <div class="instr-grid">
                <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">iPhone</a>
                <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">Android</a>
                <a href="https://t.me/+jMnq2kQHuKs0MDZi" class="instr-link">PC</a>
            </div>
        </div>
    </div>

    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <h3 style="text-align:center; margin-top:0;">–ü—Ä–∞–≤–∏–ª–∞ SkyTop VPN</h3>
            <div class="modal-scroll">
                <h4>1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è</h4>
                <p>1.1. SkyTop VPN –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å–µ—Ç–∏. –û–ø–ª–∞—Ç–∞ —è–≤–ª—è–µ—Ç—Å—è –∞–∫—Ü–µ–ø—Ç–æ–º –æ—Ñ–µ—Ä—Ç—ã.</p>
                <h4>2. –ü–æ—Ä—è–¥–æ–∫ –æ–ø–ª–∞—Ç—ã</h4>
                <p>2.1. –î–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.</p>
                <p>2.2. –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç–æ–≤–∞—Ä –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω.</p>
                <p><strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</strong> <a href="https://t.me/Yaakkoo">@Yaakkoo</a></p>
            </div>
            <button class="close-modal" onclick="closeRules()">–ü—Ä–∏–Ω–∏–º–∞—é</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 0;
        
        // –¢–í–û–ô IP –°–ï–†–í–ï–†–ê (–û—Å—Ç–∞–≤–ª—è–µ–º 443 –ø–æ—Ä—Ç)
        const BASE_URL = 'https://api.skytop.space'; 

        function toggleMenu() {
            const menu = document.getElementById("dropdown-menu");
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        function showRules() {
            document.getElementById("rules-modal").style.display = "block";
            toggleMenu();
        }

        function closeRules() {
            document.getElementById("rules-modal").style.display = "none";
        }

        function openSupport() {
            tg.openTelegramLink("https://t.me/Yaakkoo");
            toggleMenu();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞
        async function updateStatus() {
            const statusEl = document.getElementById('sub-status');
            const dateEl = document.getElementById('sub-date');
            
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É –Ω–∞—à–µ–≥–æ Python —Å–µ—Ä–≤–µ—Ä–∞
                const res = await fetch(`${BASE_URL}/get-status?user_id=${userId}`);
                const data = await res.json();
                
                if (data.time_left && data.time_left !== "0–¥ 0—á" && data.time_left !== "–ò—Å—Ç–µ–∫–ª–∞") {
                    statusEl.innerText = "–ê–∫—Ç–∏–≤–Ω–∞";
                    statusEl.style.color = "#34c759";
                    dateEl.innerText = "–û—Å—Ç–∞–ª–æ—Å—å: " + data.time_left;
                } else {
                    statusEl.innerText = "–ù–µ –∞–∫—Ç–∏–≤–Ω–∞";
                    statusEl.style.color = "#ff3b30";
                    dateEl.innerText = "–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞";
                }
            } catch (e) {
                statusEl.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞";
                dateEl.innerText = "–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç";
                console.error("Status error:", e);
            }
        }

        let chosenAmount = 0;
        function selectPrice(amount, element) {
            chosenAmount = amount;
            document.querySelectorAll('.opt-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            const payBtn = document.getElementById('confirm-pay-btn');
            payBtn.style.display = 'block';
            payBtn.innerText = `–û–ø–ª–∞—Ç–∏—Ç—å ${amount} ‚ÇΩ`;
        }

        // –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã
        async function processPayment() {
            if (!chosenAmount) return;
            const btn = document.getElementById('confirm-pay-btn');
            btn.disabled = true;
            btn.innerText = "–°–æ–∑–¥–∞–µ–º —Å—á–µ—Ç...";

            try {
                const response = await fetch(`${BASE_URL}/create-payment`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ amount: chosenAmount, user_id: userId })
                });
                
                const result = await response.json();
                
                if (result.link) {
                    tg.openLink(result.link);
                } else {
                    tg.showAlert("–û—à–∏–±–∫–∞: " + (result.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
                }
            } catch (err) {
                tg.showAlert("–°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞!");
                console.error("Payment error:", err);
            } finally {
                btn.disabled = false;
                btn.innerText = `–û–ø–ª–∞—Ç–∏—Ç—å ${chosenAmount} ‚ÇΩ`;
            }
        }

        function copyReferralLink() {
            const link = `https://t.me/skytopvpnbot?start=${userId}`;
            // –ü–æ–ø—ã—Ç–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            const el = document.createElement('textarea');
            el.value = link;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        }

        function shareReferralLink() {
            const link = `https://t.me/skytopvpnbot?start=${userId}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=–ü–æ–ª—å–∑—É—é—Å—å —ç—Ç–∏–º VPN, —Å–æ–≤–µ—Ç—É—é!`);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        updateStatus();
    </script>
</body>
</html>


